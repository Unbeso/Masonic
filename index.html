<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Attendance Average Calculator</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Attendance Calculator">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        p {
            text-align: center;
            color: #666;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f7f7f7;
        }
        input[type="number"] {
            width: 90%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            text-align: center;
            font-weight: bold;
            color: #4CAF50;
            margin-top: 20px;
        }
        #chart-container {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monthly Attendance Average Calculator</h1>
        <p>Enter the number of attendees for each meeting and any special events to calculate averages for two years.</p>

        <form id="attendance-form">
            <label for="start-year">Select Start Year:</label>
            <select id="start-year" name="start-year" required>
                <script>
                    const currentYear = new Date().getFullYear();
                    for (let year = currentYear - 10; year <= currentYear + 10; year++) {
                        document.write(`<option value="${year}">${year}</option>`);
                    }
                </script>
            </select>

            <label for="end-year">Select End Year:</label>
            <select id="end-year" name="end-year" required>
                <script>
                    for (let year = currentYear - 10; year <= currentYear + 10; year++) {
                        document.write(`<option value="${year}">${year}</option>`);
                    }
                </script>
            </select>

            <div id="yearly-attendance"></div>

            <button type="submit">Calculate Average</button>
        </form>

        <p class="result" id="average-result"></p>

        <div id="chart-container">
            <canvas id="attendance-chart"></canvas>
        </div>
    </div>

    <script>
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const yearlyAttendance = document.getElementById('yearly-attendance');
        const resultElement = document.getElementById('average-result');
        const startYearSelect = document.getElementById('start-year');
        const endYearSelect = document.getElementById('end-year');
        const chartCanvas = document.getElementById('attendance-chart');
        let chartInstance;

        function generateYearlyInputs(startYear, endYear) {
            yearlyAttendance.innerHTML = '';
            for (let year = startYear; year <= endYear; year++) {
                const yearContainer = document.createElement('div');
                yearContainer.classList.add('year-container');
                yearContainer.innerHTML = `<h3>Year: ${year}</h3>`;

                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Meeting 1 Attendance</th>
                            <th>Meeting 2 Attendance</th>
                            <th>Special Event Attendance</th>
                        </tr>
                    </thead>
                `;

                const tbody = document.createElement('tbody');
                months.forEach(month => {
                    const row = document.createElement('tr');

                    const monthCell = document.createElement('td');
                    monthCell.textContent = month;
                    row.appendChild(monthCell);

                    const meeting1Cell = document.createElement('td');
                    const meeting1Input = document.createElement('input');
                    meeting1Input.type = 'number';
                    meeting1Input.inputMode = 'numeric';
                    meeting1Input.name = `meeting1-${year}-${month}`;
                    meeting1Input.placeholder = '0';
                    meeting1Cell.appendChild(meeting1Input);
                    row.appendChild(meeting1Cell);

                    const meeting2Cell = document.createElement('td');
                    const meeting2Input = document.createElement('input');
                    meeting2Input.type = 'number';
                    meeting2Input.inputMode = 'numeric';
                    meeting2Input.name = `meeting2-${year}-${month}`;
                    meeting2Input.placeholder = '0';
                    meeting2Cell.appendChild(meeting2Input);
                    row.appendChild(meeting2Cell);

                    const specialEventCell = document.createElement('td');
                    const specialEventInput = document.createElement('input');
                    specialEventInput.type = 'number';
                    specialEventInput.inputMode = 'numeric';
                    specialEventInput.name = `specialEvent-${year}-${month}`;
                    specialEventInput.placeholder = '0';
                    specialEventCell.appendChild(specialEventInput);
                    row.appendChild(specialEventCell);

                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                yearContainer.appendChild(table);
                yearlyAttendance.appendChild(yearContainer);
            }
        }

        startYearSelect.addEventListener('change', () => {
            const startYear = parseInt(startYearSelect.value);
            const endYear = parseInt(endYearSelect.value);
            if (!isNaN(startYear) && !isNaN(endYear) && startYear <= endYear) {
                generateYearlyInputs(startYear, endYear);
            }
        });

        endYearSelect.addEventListener('change', () => {
            const startYear = parseInt(startYearSelect.value);
            const endYear = parseInt(endYearSelect.value);
            if (!isNaN(startYear) && !isNaN(endYear) && startYear <= endYear) {
                generateYearlyInputs(startYear, endYear);
            }
        });

        document.getElementById('attendance-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const startYear = parseInt(startYearSelect.value);
            const endYear = parseInt(endYearSelect.value);

            if (isNaN(startYear) || isNaN(endYear) || startYear > endYear) {
                alert('Please select valid start and end years.');
                return;
            }

            let total = 0;
            let meetingCount = 0;
            let specialEventTotal = 0;
            let specialEventCount = 0;
            const monthlyTotals = Array(12).fill(0);

            for (let year = startYear; year <= endYear; year++) {
                months.forEach((month, index) => {
                    const meeting1Value = parseInt(document.querySelector(`input[name="meeting1-${year}-${month}"]`)?.value) || 0;
                    const meeting2Value = parseInt(document.querySelector(`input[name="meeting2-${year}-${month}"]`)?.value) || 0;
                    const specialEventValue = parseInt(document.querySelector(`input[name="specialEvent-${year}-${month}"]`)?.value) || 0;

                    total += meeting1Value + meeting2Value;
                    meetingCount += (meeting1Value > 0) + (meeting2Value > 0);
                    specialEventTotal += specialEventValue;
                    specialEventCount += specialEventValue > 0 ? 1 : 0;
                    monthlyTotals[index % 12] += meeting1Value + meeting2Value;
                });
            }

            const monthlyAverage = total / 12;
            const perMeetingAverage = total / meetingCount;

            resultElement.innerHTML = `
                <p>Monthly Average Attendance: ${monthlyAverage.toFixed(2)} people</p>
                <p>Average Attendance Per Meeting: ${perMeetingAverage.toFixed(2)} people</p>
                <p>Total Special Events: ${specialEventCount}</p>
                <p>Total Attendance for Special Events: ${specialEventTotal}</p>
            `;

            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(chartCanvas, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly Attendance',
                        data: monthlyTotals,
                        borderColor: '#4CAF50',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
